

#include <UnoWiFiDevEd.h>
#ifndef BlynkSimpleCurieBLE_h
#define BlynkSimpleCurieBLE_h

#ifndef BLYNK_INFO_CONNECTION
#define BLYNK_INFO_CONNECTION "CurieBLE"
#endif

#define BLYNK_SEND_ATOMIC
#define BLYNK_SEND_CHUNK 20
//#define BLYNK_SEND_THROTTLE 20

#include <BlynkApiArduino.h>
#include <Blynk/BlynkProtocol.h>
#include <utility/BlynkFifo.h>
#include <CurieBLE.h>



#define BLYNK_PRINT Serial

#include <BlynkSimplecurieBLE.h>
#include <ArduinoBLE.h>
#include <Ultrasonic.h>

// You should get Auth Token in the Blynk App.
// Go to the Project Settings (nut icon).
char auth[] = "e89c8784857148c4b01975b89e517663";

BLEPeripheral  blePeripheral;
WidgetLED green(V1);
WidgetLED orange(V2);
WidgetLED red(V3);


Ultrasonic ultrasonic(7);
int distance = 0;
int thresh [3] = {20,12,4};


void setup() {
  Serial.begin(9600);
  delay(1000);

  blePeripheral.setLocalName("garbage");
  blePeripheral.setDeviceName("garbage");
  blePeripheral.setAppearance(384);
  Blynk.begin(blePeripheral, auth);
  blePeripheral.begin();
  Serial.println("Waiting for connections...");
}

void loop() {
distance = ultrasonic.distanceRead();
Serial.print(distance);
Blynk.run();
  if(distance<=thresh[0]&&distance>=thresh[1]&&distance>=thresh[2]){
    green.on();
    Serial.println(1);
    }
  else if(distance<=thresh[0]&&distance<=thresh[1]&&distance>=thresh[2]){
    green.on();
    orange.on();
    Serial.println(2);
  }
  else if(distance<=thresh[0]&&distance<=thresh[1]&&distance<=thresh[2]){
    green.on();
    orange.on();
    red.on();
    Serial.println(3);
  }
  else{
    green.off();
    orange.off();
    red.off();
    Serial.println(0);
  }
  delay(100);

}

